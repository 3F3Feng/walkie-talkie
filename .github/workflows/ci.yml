name: CI

on:
  push:
    branches: [main, migrate-to-ble]
  pull_request:
    branches: [main]

jobs:
  build-and-test:
    name: Build & Test (iOS)
    runs-on: macos-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Setup Xcode
        run: |
          sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
          xcodebuild -version
          
      - name: Install XcodeGen
        run: |
          brew install xcodegen
          
      - name: Generate Xcode Project
        run: |
          xcodegen generate
          
      - name: Build with Xcode
        run: |
          echo "ğŸ”¨ ä½¿ç”¨ Xcode æ„å»º..."
          xcodebuild -project WolkieTalkie.xcodeproj -scheme WolkieTalkie -configuration Debug -destination 'platform=iOS Simulator,name=iPhone 15' build CODE_SIGNING_ALLOWED=NO
          
      - name: Run Tests with Xcode
        run: |
          echo "ğŸ§ª è¿è¡Œ iOS æµ‹è¯•..."
          xcodebuild -project WolkieTalkie.xcodeproj -scheme WolkieTalkie -configuration Debug -destination 'platform=iOS Simulator,name=iPhone 15' test CODE_SIGNING_ALLOWED=NO
          
      - name: Summary
        if: always()
        run: |
          echo ""
          echo "âœ… CI å®Œæˆ"
          echo "æ„å»º: success"
          echo "æµ‹è¯•: success"
